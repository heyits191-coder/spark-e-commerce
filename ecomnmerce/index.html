<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STREET.CO</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              display: ['Oswald', 'sans-serif'],
            },
            colors: {
              street: {
                black: '#000000',
                white: '#FFFFFF',
                gray: '#F3F3F3',
                red: '#FF0000',
              }
            },
            animation: {
              'marquee': 'marquee 25s linear infinite',
            },
            keyframes: {
              marquee: {
                '0%': { transform: 'translateX(0%)' },
                '100%': { transform: 'translateX(-100%)' },
              }
            }
          },
        },
      }
    </script>

    <style>
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "@google/generative-ai": "https://esm.sh/@google/generative-ai@0.1.3"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-white text-black antialiased">
    <div id="root"></div>

    <script>
      window.onerror = function(message, source, lineno, colno, error) {
        document.getElementById('root').innerHTML = `
          <div style="padding: 20px; color: red; font-family: monospace; background: #xffe; border: 1px solid red; margin: 20px;">
            <h2 style="font-weight: bold; font-size: 1.2em;">Javascript Error (White Screen Fix)</h2>
            <p><strong>Error:</strong> ${message}</p>
            <p><strong>Line:</strong> ${lineno}</p>
            <p>Please check your code or API Key configuration.</p>
          </div>
        `;
      };
    </script>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { ShoppingBag, Search, Menu, Plus, X, Minus, Trash2, Sparkles, Send } from 'lucide-react';
      
      // FIX 1: Correct Import Name for the Stable SDK
      import { GoogleGenerativeAI } from '@google/generative-ai';

      // FIX 2: Define API Key here directly to avoid process.env issues
      // REPLACE THIS TEXT WITH YOUR ACTUAL KEY
      const API_KEY = "YOUR_API_KEY_HERE"; 

      // --- CONSTANTS ---
      const PRODUCTS = [
        { id: '1', name: 'VOID HOODIE', price: 4500, category: 'TOPS', image: 'https://images.unsplash.com/photo-1578587018452-892bacefd3f2?q=80&w=1000&auto=format&fit=crop', isNew: true },
        { id: '2', name: 'TACTICAL CARGO', price: 3200, category: 'BOTTOMS', image: 'https://images.unsplash.com/photo-1552160753-117159821e01?q=80&w=1000&auto=format&fit=crop' },
        { id: '3', name: 'OVERSIZED TEE', price: 1800, category: 'TOPS', image: 'https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?q=80&w=1000&auto=format&fit=crop' },
        { id: '4', name: 'UTILITY VEST', price: 5600, category: 'OUTERWEAR', image: 'https://images.unsplash.com/photo-1559582798-678dfc71ccd8?q=80&w=1000&auto=format&fit=crop' },
        { id: '5', name: 'RAW HEM DENIM', price: 4200, category: 'BOTTOMS', image: 'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?q=80&w=1000&auto=format&fit=crop' },
        { id: '6', name: 'MONOLITH PUFFER', price: 8900, category: 'OUTERWEAR', image: 'https://images.unsplash.com/photo-1545959728-6b7123aa6323?q=80&w=1000&auto=format&fit=crop', isNew: true },
        { id: '7', name: 'INDUSTRIAL BELT', price: 1200, category: 'ACCESSORIES', image: 'https://images.unsplash.com/photo-1616150537482-1df6c52a326b?q=80&w=1000&auto=format&fit=crop' },
        { id: '8', name: 'CYBER BEANIE', price: 900, category: 'ACCESSORIES', image: 'https://images.unsplash.com/photo-1576871337632-b9aef4c17ab9?q=80&w=1000&auto=format&fit=crop' }
      ];

      const SYSTEM_INSTRUCTION = `You are the AI Stylist for STREET.CO. Tone: Edgy, brutalist, high-fashion. Currency: INR. Only recommend from: ${PRODUCTS.map(p => p.name).join(', ')}.`;

      const HERO_IMAGES = [
        "https://images.unsplash.com/photo-1540221652346-e5dd6b50f3e7?q=80&w=2669&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1617331140180-e843d63d3f9f?q=80&w=2070&auto=format&fit=crop"
      ];

      // --- COMPONENTS ---

      const Marquee = () => (
        <div className="bg-street-black text-street-white py-2 overflow-hidden relative z-50">
          <div className="whitespace-nowrap animate-marquee font-display font-bold tracking-[0.2em] text-xs md:text-sm">
            <span className="mx-4">FREE SHIPPING WORLDWIDE • NEW DROP AVAILABLE • URBAN CHAOS COLLECTION • </span>
            <span className="mx-4">FREE SHIPPING WORLDWIDE • NEW DROP AVAILABLE • URBAN CHAOS COLLECTION • </span>
          </div>
        </div>
      );

      const Navbar = ({ cartCount, onCartClick }) => (
        <nav className="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-gray-100">
          <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Menu className="w-6 h-6 md:hidden cursor-pointer" />
              <div className="hidden md:flex gap-6 text-sm font-medium tracking-wide">
                <a href="#" className="hover:underline">SHOP</a>
                <a href="#" className="hover:underline">COLLECTIONS</a>
                <a href="#" className="text-street-red">SALE</a>
              </div>
            </div>
            <div className="absolute left-1/2 transform -translate-x-1/2">
              <h1 className="font-display font-bold text-2xl md:text-3xl tracking-tighter">STREET.CO</h1>
            </div>
            <div className="flex items-center gap-6">
              <Search className="w-5 h-5 cursor-pointer" />
              <div className="relative cursor-pointer" onClick={onCartClick}>
                <ShoppingBag className="w-5 h-5" />
                {cartCount > 0 && (
                  <span className="absolute -top-2 -right-2 bg-street-red text-white text-[10px] font-bold w-4 h-4 flex items-center justify-center rounded-full">
                    {cartCount}
                  </span>
                )}
              </div>
            </div>
          </div>
        </nav>
      );

      const Hero = () => {
        const [index, setIndex] = useState(0);
        useEffect(() => {
          const t = setInterval(() => setIndex(i => (i + 1) % HERO_IMAGES.length), 4000);
          return () => clearInterval(t);
        }, []);

        return (
          <section className="relative h-[80vh] w-full bg-street-black overflow-hidden">
            <div className="absolute inset-0">
              {HERO_IMAGES.map((img, i) => (
                <div key={img} className={`absolute inset-0 transition-opacity duration-1000 ${i === index ? 'opacity-100' : 'opacity-0'}`}>
                  <img src={img} className="w-full h-full object-cover opacity-60" />
                </div>
              ))}
              <div className="absolute inset-0 bg-gradient-to-t from-street-black via-transparent to-transparent"></div>
            </div>
            <div className="relative h-full flex flex-col items-center justify-center text-center px-4 z-30">
              <h2 className="font-display font-bold text-6xl md:text-9xl text-white tracking-tighter mb-6 mix-blend-difference">URBAN<br/>CHAOS</h2>
              <button className="bg-white text-black font-display font-bold text-lg px-8 py-3 tracking-widest hover:bg-street-red hover:text-white transition-all">SHOP NOW</button>
            </div>
          </section>
        );
      };

      const ProductCard = ({ product, onAddToCart }) => (
        <div className="group relative cursor-pointer">
          <div className="relative aspect-[3/4] overflow-hidden bg-gray-100">
            <img src={product.image} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
            {product.isNew && <div className="absolute top-2 left-2 bg-black text-white text-[10px] font-bold px-2 py-1">NEW</div>}
            <button onClick={(e) => { e.stopPropagation(); onAddToCart(product); }} className="absolute bottom-4 right-4 bg-white text-black p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all hover:bg-black hover:text-white">
              <Plus className="w-5 h-5" />
            </button>
          </div>
          <div className="mt-4">
            <h3 className="font-display font-bold text-lg">{product.name}</h3>
            <p className="text-sm">₹{product.price}</p>
          </div>
        </div>
      );

      const CartDrawer = ({ isOpen, onClose, items, onUpdateQuantity, onRemoveItem }) => {
        if (!isOpen) return null;
        return (
          <div className="fixed inset-0 z-50 flex justify-end">
            <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={onClose}></div>
            <div className="relative w-full md:w-[450px] bg-white h-full shadow-2xl flex flex-col animate-slideIn">
              <div className="p-6 border-b flex justify-between items-center">
                <h2 className="font-display font-bold text-2xl">CART ({items.length})</h2>
                <button onClick={onClose}><X className="w-6 h-6" /></button>
              </div>
              <div className="flex-1 overflow-y-auto p-6 space-y-6">
                {items.length === 0 ? <div className="text-center text-gray-400 mt-20">Cart Empty</div> : 
                  items.map(item => (
                    <div key={item.id} className="flex gap-4">
                      <img src={item.image} className="w-20 h-24 object-cover bg-gray-100" />
                      <div className="flex-1 flex flex-col justify-between">
                        <div>
                          <div className="flex justify-between"><h3 className="font-bold text-sm">{item.name}</h3><button onClick={() => onRemoveItem(item.id)}><Trash2 className="w-4 h-4 text-gray-400" /></button></div>
                          <p className="text-xs text-gray-500">{item.category}</p>
                        </div>
                        <div className="flex justify-between items-center">
                          <div className="flex border"><button onClick={() => onUpdateQuantity(item.id, -1)} className="p-1 px-2">-</button><span className="px-2 text-sm pt-1">{item.quantity}</span><button onClick={() => onUpdateQuantity(item.id, 1)} className="p-1 px-2">+</button></div>
                          <span className="font-bold text-sm">₹{item.price * item.quantity}</span>
                        </div>
                      </div>
                    </div>
                  ))
                }
              </div>
              <div className="p-6 border-t bg-gray-50">
                <div className="flex justify-between mb-4 font-bold text-xl"><span>TOTAL</span><span>₹{items.reduce((a,c) => a + c.price * c.quantity, 0)}</span></div>
                <button className="w-full bg-black text-white py-4 font-bold tracking-widest hover:bg-street-red">CHECKOUT</button>
              </div>
            </div>
          </div>
        );
      };

      const AiStylist = () => {
        const [isOpen, setIsOpen] = useState(false);
        const [messages, setMessages] = useState([{ role: 'model', text: 'Yo. Need a fit check?' }]);
        const [input, setInput] = useState('');
        const [loading, setLoading] = useState(false);
        const scrollRef = useRef(null);

        useEffect(() => { scrollRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages, isOpen]);

        const handleSend = async () => {
          if (!input.trim() || loading) return;
          const userText = input;
          setInput('');
          setMessages(prev => [...prev, { role: 'user', text: userText }]);
          setLoading(true);

          try {
            if (!API_KEY || API_KEY.includes('YOUR_API_KEY')) throw new Error("API Key not set");
            
            // FIX 3: Correct Class Instantiation
            const genAI = new GoogleGenerativeAI(API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash", systemInstruction: SYSTEM_INSTRUCTION });
            
            const chat = model.startChat({ history: messages.map(m => ({ role: m.role, parts: [{ text: m.text }] })) });
            const result = await chat.sendMessage(userText);
            const response = await result.response;
            setMessages(prev => [...prev, { role: 'model', text: response.text() }]);
          } catch (e) {
            setMessages(prev => [...prev, { role: 'model', text: "System offline. Check API Key." }]);
            console.error(e);
          }
          setLoading(false);
        };

        return (
          <>
            <button onClick={() => setIsOpen(true)} className={`fixed bottom-6 right-6 z-40 bg-black text-white p-4 rounded-full shadow-xl hover:scale-110 transition ${isOpen ? 'hidden' : 'flex'}`}>
              <Sparkles className="w-6 h-6 text-street-red" />
            </button>
            <div className={`fixed bottom-6 right-6 w-[90vw] md:w-[350px] h-[500px] bg-white border border-black shadow-2xl z-50 flex flex-col transition-all origin-bottom-right ${isOpen ? 'scale-100' : 'scale-0'}`}>
              <div className="bg-black text-white p-4 flex justify-between items-center"><span className="font-bold tracking-widest flex items-center gap-2"><Sparkles className="w-4 h-4 text-red-500"/> AI STYLIST</span><button onClick={() => setIsOpen(false)}><X className="w-5 h-5"/></button></div>
              <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                {messages.map((m, i) => (
                  <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`p-3 max-w-[85%] text-sm ${m.role === 'user' ? 'bg-black text-white' : 'bg-white border text-black'}`}>{m.text}</div>
                  </div>
                ))}
                {loading && <div className="text-xs text-gray-500 animate-pulse">Computing...</div>}
                <div ref={scrollRef}></div>
              </div>
              <div className="p-4 border-t flex gap-2">
                <input value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSend()} placeholder="Ask for outfits..." className="flex-1 bg-gray-100 p-2 text-sm outline-none border focus:border-black" />
                <button onClick={handleSend} className="bg-black text-white p-2 hover:bg-red-600"><Send className="w-4 h-4"/></button>
              </div>
            </div>
          </>
        );
      };

      const App = () => {
        const [isCartOpen, setIsCartOpen] = useState(false);
        const [cart, setCart] = useState([]);

        const addToCart = (p) => {
          setCart(prev => {
            const ex = prev.find(i => i.id === p.id);
            return ex ? prev.map(i => i.id === p.id ? { ...i, quantity: i.quantity + 1 } : i) : [...prev, { ...p, quantity: 1 }];
          });
          setIsCartOpen(true);
        };

        const updateQty = (id, d) => setCart(prev => prev.map(i => i.id === id ? { ...i, quantity: Math.max(1, i.quantity + d) } : i));
        const removeItem = (id) => setCart(prev => prev.filter(i => i.id !== id));

        return (
          <div className="min-h-screen flex flex-col font-sans">
            <Marquee />
            <Navbar cartCount={cart.reduce((a,c) => a + c.quantity, 0)} onCartClick={() => setIsCartOpen(true)} />
            <main className="flex-grow">
              <Hero />
              <section className="max-w-7xl mx-auto px-6 py-20">
                <h2 className="font-display font-bold text-4xl mb-10 tracking-tighter">LATEST DROP</h2>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                  {PRODUCTS.map(p => <ProductCard key={p.id} product={p} onAddToCart={addToCart} />)}
                </div>
              </section>
            </main>
            <CartDrawer isOpen={isCartOpen} onClose={() => setIsCartOpen(false)} items={cart} onUpdateQuantity={updateQty} onRemoveItem={removeItem} />
            <AiStylist />
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
